package com.example.livedatalifecycleaware

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.widget.Button
import android.widget.TextView
import androidx.activity.viewModels
import androidx.lifecycle.Observer
import com.example.livedatalifecycleaware.viewmodel.NameViewModel
import java.util.*

/*
Observe LiveData objects
In most cases an app component's onCreate() method is the right place to
begin observing LiveData object for foll. reasons
1. To ensure the sys doesn't make redundant calls from an activity/frag's
onResume() method.
2. To ensure that the activity or frag has data that it can display as
soon as it becomes active. As soon as app compo is in the STARTED state,
it receives most recent value from LiveData objects it's observing. This
only occurs if the LiveData object to be observed has been set.

Generally , LiveData delivers updates only when data changes , and only to
active observers. An exception to this behavior is that observers also
receive update when they change from inactive to active state.
Furthermore, if the observer changes from inactive to active second time
it only receives update if the value has changed since the last time
it became active.

 */
class NameActivity : AppCompatActivity() {

    //Use the 'by viewModels()' Kotlin property delegate
    //from the activity-ktx artifact
    private val model: NameViewModel by viewModels()

    private lateinit var nameTextView: TextView

    private lateinit var updateLivedataButton: Button

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        nameTextView = findViewById(R.id.text_view_name)
        updateLivedataButton = findViewById(R.id.btn_update_livedata)

        //Other code to setup the activity..

        //Create the observer which updates UI.
        val nameObserver = Observer<String> { newName ->
            //Update the UI , in this case , a TextView
            nameTextView.text = newName
        }

        //Observe the LiveData , passing in this activity as the
        //LifecycleOwner and the observer.

        /*
        After foll. line is called onChanged() is immediately invoked
        providing the most recent value stored in currentName.
        If the LiveData object hasn't set a value in currentName ,
        onChanged                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           () is not called.
         */
        model.currentName.observe(this , nameObserver)

        /*
        Update LiveData objects
        LiveData has no publicly available methods to update the stored
        data. MutableLiveData class exposes the setValue(T) and postValue(T)
        methods publicly and u must use these if u need to edit the value
        stored in a LiveData object. Usually MutableLiveData is used in
        the ViewModel and then the ViewModel only exposes immutable
        LiveData objects to the observers
         */

        updateLivedataButton.setOnClickListener {

            val anotherName = "Aditi"
            model.currentName.setValue(anotherName)
            /*
            Calling setValue in the ex. results in the observers calling
            their onChanged() with value "Aditi" The ex. shows the button
            press but setValue() or postValue() could be called to update
            name for a variety of reasons including in response to a network
            request or a DB load completing , in all cases call to setValue()
            or postValue() triggers observers and updates UI.

             */
        }
    }
}